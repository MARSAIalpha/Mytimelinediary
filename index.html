<!DOCTYPE html>
<html lang="zh-CN" class="overflow-x-hidden">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0077be">
    <title>Timeline Flow</title>
    <script src="lib/tailwindcss.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700;900&family=Noto+Sans+SC:wght@300;400;700&family=Ma+Shan+Zheng&display=swap" rel="stylesheet">
    
    <script src="lib/lucide.js"></script>
    <script src="lib/marked.min.js"></script>
    <script src="lib/lunar.js"></script>
    <script src="lib/html2pdf.bundle.min.js"></script>
    
    <link rel="stylesheet" href="style.css">
<base target="_blank">
<base target="_blank">
</head>
<body class="antialiased h-screen flex flex-col select-none" data-theme="day">

    <canvas id="world-canvas"></canvas>
    <div class="orbit-wrapper"><div id="orbit-wheel" class="orbit-wheel"><div class="celestial-body sun-body"></div><div class="celestial-body moon-body"><div class="crescent-shape"></div></div></div></div>

    <header class="fixed top-0 w-full h-20 z-50 flex items-center justify-center px-4 bg-gradient-to-b from-[rgba(255,255,255,0.1)] to-transparent backdrop-blur-[2px]">
        <div class="nav-capsule shadow-lg">
            <button onclick="UI.switchView('timeline')" id="btn-timeline" class="nav-btn active" data-i18n="nav_timeline">TIMELINE</button>
            <button onclick="UI.switchView('dashboard')" id="btn-dashboard" class="nav-btn" data-i18n="nav_dashboard">DASHBOARD</button>
            <button onclick="UI.switchView('calendar')" id="btn-calendar" class="nav-btn" data-i18n="nav_calendar">CALENDAR</button>
        </div>
    </header>

    <div id="focus-hud">
        <div class="hud-day" id="hud-day">--</div>
        <div class="hud-time-wrapper"><div class="hud-time" id="hud-time">--:--</div></div>
        <div class="hud-meta" id="hud-month-year">---</div>
    </div>

  <div id="filter-fab-group">
        <div class="filter-row" onclick="UI.toggleFilter('anni')"><div class="filter-dot f-anni active"></div><span class="filter-label label-anni" data-i18n="filter_anni">ANN</span></div>
        <div class="filter-row" onclick="UI.toggleFilter('holiday')"><div class="filter-dot f-holiday active"></div><span class="filter-label label-holiday" data-i18n="filter_holiday">HOL</span></div>
        <div class="filter-row" onclick="UI.toggleFilter('normal')"><div class="filter-dot f-normal active"></div><span class="filter-label label-normal" data-i18n="filter_diary">DIARY</span></div>
        
        <div class="filter-row mt-6" onclick="UI.scrollToToday()">
            <div class="filter-dot flex items-center justify-center bg-blue-600 border-none shadow-lg transform hover:scale-110 transition-transform">
                <i data-lucide="arrow-down-to-line" class="w-3 h-3 text-white"></i>
            </div>
            <span class="filter-label font-bold text-[10px] tracking-wider text-[var(--text-sec)] opacity-80">TODAY</span>
        </div>
    </div>

    <div id="center-guide-layer"><div class="guide-beam"></div><div class="guide-cursor" id="beam-cursor"></div></div>

    <div id="export-bar" class="fixed bottom-24 left-1/2 -translate-x-1/2 z-[60] hidden animate-in slide-in-from-bottom-4 flex gap-2">
        <div class="flex gap-1 bg-[var(--text)] p-1.5 rounded-full shadow-2xl">
            <button onclick="UI.exportSelectedMarkdown()" class="text-[var(--card-bg)] px-4 py-2 rounded-full font-bold flex items-center gap-2 hover:bg-white/20 transition-colors text-xs uppercase tracking-wider">
                <i data-lucide="file-code" class="w-4 h-4"></i> MD <span id="selected-count" class="bg-[var(--primary)] text-white text-[9px] px-1.5 py-0.5 rounded-full ml-1">0</span>
            </button>
        </div>
        <div class="flex gap-1 bg-red-500 p-1.5 rounded-full shadow-2xl">
            <button onclick="UI.deleteSelectedEntries()" class="text-white px-4 py-2 rounded-full font-bold flex items-center gap-2 hover:bg-red-600 transition-colors text-xs uppercase tracking-wider">
                <i data-lucide="trash-2" class="w-4 h-4"></i>
            </button>
        </div>
    </div>

    <main id="main-container" class="flex-1 relative z-10 overflow-y-auto overflow-x-hidden">
        <div class="w-full px-0 relative min-h-full">
            
            <div id="view-timeline" class="active-view relative">
                <div id="future-placeholder" class="list-placeholder"><span data-i18n="future">Future Unwritten</span></div>
                <div class="timeline-rail-outer"><div class="timeline-rail-container"><div class="rail-center-glow"></div><div class="timeline-rail-line"></div><div class="timeline-rail-flow"></div></div></div>
                <div id="diary-list" class="relative"><div id="task-lines-layer" class="absolute top-0 left-0 w-full h-full pointer-events-none z-0"></div></div>
                <div id="origin-placeholder" class="list-placeholder"><span data-i18n="origin">The Beginning</span></div>
            </div>

            <div id="view-dashboard" class="hidden-view pt-24 pb-12">
                <div class="max-w-2xl mx-auto px-4">
                    <h2 class="text-2xl font-bold mb-4 text-[var(--text)]" data-i18n="dashboard_title">Life Rhythm</h2>
                    <div class="dashboard-grid mb-8">
                        <div class="stat-card" style="--stat-accent: #ef4444;">
                            <div class="stat-label text-[#ef4444]"><i data-lucide="flame" class="inline w-3 h-3 mr-1"></i> <span data-i18n="cat_exercise">Exercise</span></div>
                            <div class="stat-value" id="stat-exercise">--</div>
                            <div class="stat-chart-bar"><div class="stat-chart-fill bg-[#ef4444]" id="bar-exercise"></div></div>
                            <div class="text-[10px] text-right mt-1 opacity-50"><span data-i18n="lbl_target">Target</span>: <span id="target-exercise-disp">60</span>m</div>
                        </div>
                        <div class="stat-card" style="--stat-accent: #3b82f6;">
                            <div class="stat-label text-[#3b82f6]"><i data-lucide="moon" class="inline w-3 h-3 mr-1"></i> <span data-i18n="cat_sleep">Sleep</span></div>
                            <div class="stat-value" id="stat-sleep">--</div>
                            <div class="stat-chart-bar"><div class="stat-chart-fill bg-[#3b82f6]" id="bar-sleep"></div></div>
                            <div class="text-[10px] text-right mt-1 opacity-50"><span data-i18n="lbl_target">Target</span>: <span id="target-sleep-disp">8</span>h</div>
                        </div>
                        <div class="stat-card" style="--stat-accent: #10b981;">
                            <div class="stat-label text-[#10b981]"><i data-lucide="zap" class="inline w-3 h-3 mr-1"></i> <span data-i18n="cat_focus">Focus</span></div>
                            <div class="stat-value" id="stat-focus">--</div>
                            <div class="stat-chart-bar"><div class="stat-chart-fill bg-[#10b981]" id="bar-focus"></div></div>
                            <div class="text-[10px] text-right mt-1 opacity-50"><span data-i18n="lbl_target">Target</span>: <span id="target-focus-disp">240</span>m</div>
                        </div>
                        <div class="stat-card" style="--stat-accent: #a855f7;">
                            <div class="stat-label text-[#a855f7]"><i data-lucide="flower" class="inline w-3 h-3 mr-1"></i> <span data-i18n="cat_meditation">Meditation</span></div>
                            <div class="stat-value" id="stat-meditation">--</div>
                            <div class="stat-chart-bar"><div class="stat-chart-fill bg-[#a855f7]" id="bar-meditation"></div></div>
                            <div class="text-[10px] text-right mt-1 opacity-50"><span data-i18n="lbl_target">Target</span>: <span id="target-meditation-disp">30</span>m</div>
                        </div>
                    </div>
                    <div class="bg-[var(--card-bg)] rounded-xl p-6 border border-[var(--line)] shadow-lg backdrop-blur-xl mb-8">
                        <div class="flex justify-between items-center mb-6 border-b border-[var(--line)] pb-2">
                            <h3 class="text-lg font-bold text-[var(--text)] flex items-center gap-2"><i data-lucide="utensils" class="w-5 h-5 text-orange-500"></i> <span data-i18n="stat_nutrition">Nutrition</span></h3>
                            <div class="text-right"><div class="text-[10px] text-[var(--text-sec)] uppercase font-bold"><span data-i18n="lbl_target">Target</span> / <span data-i18n="lbl_actual">Actual</span></div><div class="text-xs font-bold font-num"><span class="opacity-50" id="target-calories-disp">2000</span> / <span class="text-orange-500" id="stat-calories-total">0</span> kcal</div></div>
                        </div>
                        <div class="h-40 flex items-end gap-2 relative" id="calorie-chart">
                             <div class="absolute left-0 w-full border-t border-dashed border-red-400 opacity-50 z-0" style="bottom: 0; height: 1px; pointer-events: none;" id="cal-target-line"></div>
                        </div>
                    </div>
                    <h2 class="text-2xl font-bold mb-4 text-[var(--text)]" data-i18n="dashboard_tasks">Pending Tasks</h2>
                    <div id="dashboard-todo-list" class="bg-[var(--card-bg)] rounded-xl p-4 border border-[var(--line)] shadow-lg backdrop-blur-xl min-h-[100px]"></div>
                </div>
            </div>

            <div id="view-calendar" class="hidden-view pb-12 pt-24 px-4">
                <div class="bg-[var(--card-bg)] max-w-3xl mx-auto rounded-2xl p-4 shadow-xl border border-[var(--card-border)] min-h-[50vh] flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <div class="nav-capsule scale-90">
                             <button onclick="UI.switchSubView('grid')" id="btn-sub-grid" class="nav-btn active"><i data-lucide="calendar" class="w-4 h-4"></i></button>
                             <button onclick="UI.switchSubView('gallery')" id="btn-sub-gallery" class="nav-btn"><i data-lucide="image" class="w-4 h-4"></i></button>
                             <button onclick="UI.switchSubView('data')" id="btn-sub-data" class="nav-btn"><i data-lucide="database" class="w-4 h-4"></i></button>
                         </div>
                    </div>
                    
                    <div id="calendar-container">
                        <div class="flex justify-between items-center mb-4 border-b border-[var(--line)] pb-4">
                            <button onclick="UI.changeMonth(-1)"><i data-lucide="chevron-left" class="w-6 h-6 text-[var(--text)]"></i></button>
                            <div class="text-center" onclick="UI.resetCalendarToday()">
                                <h2 class="text-3xl font-bold text-[var(--primary)]" id="cal-month-display">Nov</h2>
                                <div class="text-xs font-num text-[var(--text-sec)] tracking-widest" id="cal-year-display">2025</div>
                            </div>
                            <button onclick="UI.changeMonth(1)"><i data-lucide="chevron-right" class="w-6 h-6 text-[var(--text)]"></i></button>
                        </div>
                        <div class="grid grid-cols-7 gap-2 text-center mb-2 text-[10px] font-bold text-[var(--text-sec)] opacity-50"><span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span></div>
                        <div class="grid grid-cols-7 gap-2" id="calendar-grid"></div>
                    </div>

                    <div id="gallery-container" class="hidden">
                        <div id="gallery-grid-view" class="grid grid-cols-3 gap-3"></div>
                        <div id="gallery-empty" class="text-center py-12 text-[var(--text-sec)] hidden"><p class="italic opacity-70 text-sm" data-i18n="empty_gallery">No images.</p></div>
                    </div>

                    <div id="data-container" class="hidden flex-1">
                        <h3 class="font-bold text-lg mb-4 text-[var(--text)]" data-i18n="data_title">Data Center</h3>
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <button onclick="DataManager.exportBackup()" class="p-4 bg-[var(--line)] rounded-xl flex flex-col items-center justify-center gap-2 hover:bg-[var(--primary)] hover:text-white transition-colors"><i data-lucide="download" class="w-6 h-6"></i><span class="text-xs font-bold uppercase" data-i18n="btn_backup">Backup JSON</span></button>
                            <button onclick="document.getElementById('backup-input').click()" class="p-4 bg-[var(--line)] rounded-xl flex flex-col items-center justify-center gap-2 hover:bg-[var(--primary)] hover:text-white transition-colors"><i data-lucide="upload" class="w-6 h-6"></i><span class="text-xs font-bold uppercase" data-i18n="btn_restore">Restore JSON</span></button>
                            <input type="file" id="backup-input" class="hidden" onchange="DataManager.importBackup(this)">
                        </div>
                        <div class="flex justify-between items-center mb-2 border-b border-[var(--line)] pb-2">
    <span class="text-xs font-bold text-[var(--text-sec)] uppercase tracking-wider" data-i18n="label_all_entries">All Entries</span>
    
    <div class="flex gap-2">
        <button onclick="UI.toggleSelectAll()" class="bg-[var(--line)] text-[var(--text)] text-xs px-3 py-1 rounded-full font-bold hidden hover:bg-[var(--primary)] hover:text-white transition-colors" id="btn-select-all">
            <i data-lucide="list-checks" class="w-3 h-3 inline mr-1"></i><span id="btn-select-all-text">All</span>
        </button>

        <button onclick="UI.toggleSelectionMode()" class="bg-[var(--text)] text-[var(--card-bg)] text-xs px-3 py-1 rounded-full font-bold flex items-center gap-1 shadow-sm active:scale-95 transition-transform" id="btn-select-mode">
            <i data-lucide="check-square" class="w-3 h-3"></i> <span id="select-btn-text" data-i18n="btn_select">Select</span>
        </button>
    </div>
</div>
                        <div id="archive-list" class="space-y-2 max-h-[40vh] overflow-y-auto pr-2"></div>
                    </div>
                </div>
            </div>

            <div id="page-footer" class="w-full mt-48 py-12 flex flex-col items-center justify-center gap-3 opacity-40 hover:opacity-100 transition-opacity cursor-pointer group" onclick="UI.openInfo()">
                <div class="flex items-center gap-2">
                   <i data-lucide="hourglass" class="w-4 h-4 text-[var(--text)] group-hover:text-[var(--primary)] transition-colors"></i>
                   <h1 class="text-sm font-logo font-bold tracking-[0.3em] uppercase text-[var(--text)] group-hover:text-[var(--primary)] transition-colors">Timeline</h1>
               </div>
               <div class="flex flex-col items-center gap-1 mt-2">
                   <div class="w-8 h-[1px] bg-[var(--text)] opacity-20 group-hover:w-12 transition-all duration-500"></div>
                   <div class="flex items-center gap-2 mt-2 text-[var(--text-sec)] group-hover:text-[var(--text)]">
                       <i data-lucide="settings" class="w-4 h-4"></i>
                       <span class="text-[10px] uppercase font-bold tracking-wider" data-i18n="info_title">Settings</span>
                   </div>
               </div>
           </div>

        </div>
    </main>

    <div id="prompt-bubble" class="hidden">What's on your mind?</div>
    
<button id="btn-ai-summary" onclick="UI.openWeeklySummary()" class="fab-glass fab-glass-purple animate-pulse-slow group">
    <i data-lucide="sparkles" class="w-6 h-6 group-hover:animate-spin-slow"></i>
</button>

    <button onclick="UI.openEditor()" class="fab-btn fixed bottom-8 right-6 w-14 h-14 bg-[var(--primary)] text-white rounded-full shadow-xl flex items-center justify-center z-40 active:scale-90 transition-transform">
        <i data-lucide="pen-tool" class="w-6 h-6"></i>
    </button>

  <div id="editor-modal" class="modal-overlay fixed inset-0 hidden z-50 flex items-end sm:items-center justify-center">
        <div class="absolute inset-0 bg-black/20 backdrop-blur-sm" onclick="UI.closeEditor()"></div>
        
       <div class="modal-content w-full h-[92vh] sm:h-[85vh] sm:max-w-2xl sm:rounded-2xl shadow-2xl flex flex-col relative z-10 transition-transform transform translate-y-full" id="editor-panel">
    
    <div class="flex justify-between items-center px-4 py-3 border-b border-[var(--line)] bg-[var(--card-bg)]/95 backdrop-blur z-20 rounded-t-2xl shrink-0">
        <button onclick="UI.closeEditor()" class="p-2 -ml-2 rounded-full hover:bg-[var(--line)] transition-colors border-none outline-none shrink-0 group">
            <i data-lucide="x" class="w-6 h-6 text-[var(--text-sec)] group-hover:text-[var(--text)]"></i>
        </button>
        
        <div class="flex bg-[var(--line)]/50 p-1 rounded-lg mx-2 shrink min-w-0 overflow-hidden">
            <button onclick="UI.setEditorType('diary')" id="type-diary" class="flex-1 px-3 py-1.5 text-[10px] font-bold uppercase rounded-md transition-all active-type whitespace-nowrap border-none outline-none">Diary</button>
            <button onclick="UI.setEditorType('task')" id="type-task" class="flex-1 px-3 py-1.5 text-[10px] font-bold uppercase rounded-md transition-all text-[var(--text-sec)] whitespace-nowrap border-none outline-none">Routine</button>
            <button onclick="UI.setEditorType('anni')" id="type-anni" class="flex-1 px-3 py-1.5 text-[10px] font-bold uppercase rounded-md transition-all text-[var(--text-sec)] whitespace-nowrap border-none outline-none">Anni</button>
        </div>

        <button onclick="DataManager.saveFromEditor()" class="shrink-0 text-white bg-[var(--primary)] px-5 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider shadow-md hover:shadow-lg active:scale-95 transition-all border-none outline-none" data-i18n="btn_save">Save</button>
    </div>

    <div class="p-6 flex-1 overflow-y-auto relative no-scrollbar flex flex-col">
        
        <input type="hidden" id="editor-id">
        <input type="hidden" id="editor-entry-type" value="diary">
        <input type="hidden" id="editor-task-cat" value="">

        <div id="editor-guide-text" class="hidden"></div>

        <div id="editor-ext-settings" class="hidden mb-6 animate-in slide-in-from-top-2 fade-in duration-200 shrink-0">
            <div class="flex items-center gap-3 mb-4 bg-[var(--line)]/30 p-3 rounded-xl border border-[var(--line)]/50">
                <i data-lucide="repeat" class="w-4 h-4 text-[var(--primary)]"></i>
                <span class="text-xs font-bold text-[var(--text-sec)] uppercase whitespace-nowrap">Repeat:</span>
                <select id="editor-recurrence" class="bg-transparent text-xs font-bold text-[var(--text)] outline-none flex-1 cursor-pointer w-full">
                    <option value="none">One-off</option>
                </select>
            </div>
            <div id="track-buttons" class="grid grid-cols-4 gap-2 mb-2">
                <button onclick="UI.setTaskCat('Exercise')" class="track-btn text-red-500" id="btn-cat-Exercise"><i data-lucide="flame" class="w-4 h-4"></i> <span class="hidden sm:inline">Sport</span></button>
                <button onclick="UI.setTaskCat('Sleep')" class="track-btn text-blue-500" id="btn-cat-Sleep"><i data-lucide="moon" class="w-4 h-4"></i> <span class="hidden sm:inline">Sleep</span></button>
                <button onclick="UI.setTaskCat('Focus')" class="track-btn text-emerald-500" id="btn-cat-Focus"><i data-lucide="zap" class="w-4 h-4"></i> <span class="hidden sm:inline">Focus</span></button>
                <button onclick="UI.setTaskCat('Meditation')" class="track-btn text-purple-500" id="btn-cat-Meditation"><i data-lucide="flower" class="w-4 h-4"></i> <span class="hidden sm:inline">Zen</span></button>
            </div>
        </div>

        <input id="editor-title" type="text" placeholder="Title..." class="w-full bg-transparent text-3xl font-bold mb-6 outline-none text-[var(--text)] font-display placeholder:text-[var(--text)]/20 text-left border-none p-0 shrink-0" data-placeholder="ph_title">
        
        <div id="editor-meta-row" class="flex flex-wrap items-center gap-2 mb-6 shrink-0">
            <div class="meta-pill" id="pill-date">
                <i data-lucide="calendar" class="w-3.5 h-3.5 opacity-50 shrink-0"></i>
                <input type="date" id="editor-date" class="bg-transparent border-none outline-none text-[var(--text)] p-0 font-bold font-sans text-xs w-24 cursor-pointer">
            </div>
            <div class="meta-pill" id="pill-time">
                <i data-lucide="clock" class="w-3.5 h-3.5 opacity-50 shrink-0"></i>
                <input type="time" id="editor-time" class="bg-transparent border-none outline-none text-[var(--primary)] p-0 font-bold font-sans text-xs w-16 cursor-pointer">
            </div>
            <div class="meta-pill group" id="pill-cals">
                <i data-lucide="utensils" class="w-3.5 h-3.5 opacity-50 group-hover:text-orange-500 transition-colors shrink-0"></i>
                <input type="number" id="editor-calories" placeholder="Kcal" class="bg-transparent border-none outline-none text-[var(--text)] p-0 font-bold font-sans text-xs w-14 placeholder:font-normal placeholder:opacity-50">
            </div>
        </div>

        <div id="editor-mood-row" class="flex flex-wrap items-end mb-4 pb-4 border-b border-[var(--line)]/50 gap-4 shrink-0">
            <div class="flex flex-col gap-3 mr-auto">
                <div class="flex items-center gap-3">
                    <span class="text-[10px] font-bold text-[var(--text-sec)] uppercase tracking-wider w-8 opacity-50 shrink-0">Wea</span>
                    <div class="flex gap-1">
                        <button onclick="UI.selectWeather('sun')" class="weather-btn w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-[var(--line)] border-none" id="weather-sun"><i data-lucide="sun" class="w-4 h-4 text-orange-400"></i></button>
                        <button onclick="UI.selectWeather('cloud')" class="weather-btn w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-[var(--line)] border-none" id="weather-cloud"><i data-lucide="cloud" class="w-4 h-4 text-sky-400"></i></button>
                        <button onclick="UI.selectWeather('rain')" class="weather-btn w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-[var(--line)] border-none" id="weather-rain"><i data-lucide="cloud-rain" class="w-4 h-4 text-indigo-400"></i></button>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <span class="text-[10px] font-bold text-[var(--text-sec)] uppercase tracking-wider w-8 opacity-50 shrink-0">Mood</span>
                    <div class="flex gap-1">
                        <button onclick="UI.selectMood('smile')" class="mood-btn w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-[var(--line)] border-none" id="mood-smile"><i data-lucide="smile" class="w-4 h-4 text-amber-500"></i></button>
                        <button onclick="UI.selectMood('meh')" class="mood-btn w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-[var(--line)] border-none" id="mood-meh"><i data-lucide="meh" class="w-4 h-4 text-slate-400"></i></button>
                        <button onclick="UI.selectMood('frown')" class="mood-btn w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-[var(--line)] border-none" id="mood-frown"><i data-lucide="frown" class="w-4 h-4 text-blue-500"></i></button>
                        <button onclick="UI.selectMood('heart')" class="mood-btn w-8 h-8 rounded-lg flex items-center justify-center transition-all hover:bg-[var(--line)] border-none" id="mood-heart"><i data-lucide="heart" class="w-4 h-4 text-pink-500"></i></button>
                    </div>
                </div>
            </div>
            <button onclick="DataManager.fetchInspiration()" class="flex items-center gap-1.5 px-4 py-2 rounded-xl bg-purple-50 text-purple-600 border border-purple-100 hover:bg-purple-100 transition-colors shadow-sm active:scale-95 h-fit self-end shrink-0">
                <i data-lucide="sparkles" class="w-3.5 h-3.5"></i>
                <span class="text-xs font-bold">Inspire AI</span>
            </button>
        </div>
        
        <div id="editor-rich-area" class="border border-[var(--line)] rounded-xl overflow-hidden bg-[var(--card-bg)] shadow-sm flex flex-col flex-1">
            <div id="editor-toolbar" class="flex items-center gap-1 p-2 bg-[var(--line)]/30 border-b border-[var(--line)] overflow-x-auto shrink-0">
                <button onclick="UI.execCmd('bold')" class="tool-btn"><i data-lucide="bold" class="w-3.5 h-3.5"></i></button>
                <button onclick="UI.execCmd('italic')" class="tool-btn"><i data-lucide="italic" class="w-3.5 h-3.5"></i></button>
                <button onclick="UI.insertText('# ')" class="tool-btn"><i data-lucide="heading" class="w-3.5 h-3.5"></i></button>
                <button onclick="UI.insertText('> ')" class="tool-btn"><i data-lucide="quote" class="w-3.5 h-3.5"></i></button>
                <div class="w-[1px] h-4 bg-[var(--text)]/20 mx-2 shrink-0"></div>
                <button onclick="document.getElementById('inline-img-input').click()" class="tool-btn text-blue-600 hover:bg-blue-50"><i data-lucide="image" class="w-3.5 h-3.5"></i></button>
                <button onclick="UI.togglePreviewMode()" id="btn-preview-toggle" class="tool-btn ml-auto hover:bg-purple-100 hover:text-purple-600 transition-colors"><i data-lucide="eye" class="w-3.5 h-3.5"></i></button>
            </div>
            <div id="editor-content" contenteditable="true" class="w-full h-full bg-transparent p-4 outline-none text-[var(--text)] leading-loose font-sans text-base whitespace-pre-wrap"></div>
            <div id="editor-md-preview" class="hidden w-full h-full bg-transparent p-4 outline-none text-[var(--text)] leading-loose font-sans text-base md-render overflow-y-auto"></div>
        </div>
    </div>
    </div>
    <input type="file" id="inline-img-input" accept="image/*" class="hidden" onchange="UI.handleInlineImage(this)">
</div>
    ```

    <div id="info-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="UI.closeInfo()"></div>
        
        <div class="bg-[var(--card-bg)] w-full max-w-md p-0 rounded-3xl relative z-10 border border-[var(--card-border)] shadow-2xl flex flex-col h-[85vh] overflow-hidden">
            
            <div class="p-5 border-b border-[var(--line)] flex justify-between items-center bg-[var(--card-bg)]/95 backdrop-blur z-20">
                <h2 class="text-lg font-bold text-[var(--text)] tracking-wider flex items-center gap-2">
                    <i data-lucide="book-open" class="w-4 h-4 opacity-50"></i>
                    <span data-i18n="info_title">Grimoire & Settings</span>
                </h2>
                <button onclick="UI.closeInfo()" class="p-2 hover:bg-[var(--line)] rounded-full transition-colors"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>

            <div class="p-6 flex-1 overflow-y-auto text-[var(--text)] no-scrollbar">
                
                <div class="flex justify-center gap-3 mb-8">
                    <button onclick="UI.setLanguage('en')" class="px-6 py-1.5 rounded-full border border-[var(--line)] hover:bg-[var(--primary)] hover:text-white text-xs font-bold transition-all" id="lang-en">English</button>
                    <button onclick="UI.setLanguage('zh')" class="px-6 py-1.5 rounded-full border border-[var(--line)] hover:bg-[var(--primary)] hover:text-white text-xs font-bold transition-all" id="lang-zh">ä¸­æ–‡</button>
                </div>

                <div class="flex flex-col items-center justify-center mb-10 mt-2">
                    <div class="relative w-16 h-16 flex items-center justify-center mb-3 group cursor-pointer">
                        <div class="absolute inset-0 rounded-full border-2 border-[var(--primary)] opacity-20 group-hover:scale-110 transition-transform duration-1000"></div>
                        <div class="absolute inset-0 rounded-full border border-[var(--primary)] opacity-40 animate-pulse-slow"></div>
                        <div class="absolute inset-2 rounded-full bg-[var(--card-bg)] shadow-sm flex items-center justify-center z-10">
                            <i data-lucide="hourglass" class="w-6 h-6 text-[var(--primary)]"></i>
                        </div>
                    </div>
                    <h1 class="font-logo text-2xl font-bold text-[var(--text)] tracking-[0.3em] uppercase">Timeline</h1>
                    <div class="w-8 h-[1px] bg-[var(--primary)] opacity-30 my-2"></div>
                    <p class="text-[9px] font-serif text-[var(--text-sec)] uppercase tracking-[0.3em]">The Grimoire of Now</p>
                </div>

                <div id="guide-zh" class="space-y-8 font-sans text-sm leading-relaxed hidden">
                    
                    <div class="p-5 rounded-2xl bg-gradient-to-br from-[var(--card-bg)] to-[var(--line)]/50 border border-[var(--line)] shadow-sm text-center relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-[var(--primary)] opacity-50"></div>
                        <h3 class="font-logo font-bold text-base text-[var(--primary)] mb-3 tracking-widest">ä½ å¥½ï¼Œæ—¶ç©ºæ—…äºº</h3>
                        <p class="opacity-80 text-xs leading-loose text-justify indent-0 px-2">
                            å¬æˆ‘è¯´ï¼Œè¿™ä¸ä»…ä»…æ˜¯ä¸ªæ—¥è®°æœ¬ã€‚è¿™æ˜¯ä¸€æ¡<strong>æ²³</strong>ã€‚<br><br>
                            è¿™é‡Œæ²¡æœ‰ç¿»é¡µçš„å“—å•¦å£°ï¼Œåªæœ‰æ—¶é—´åƒæ°´ä¸€æ ·æµè¿‡ã€‚ä½ çœ‹ï¼Œå½“çª—å¤–å¤©äº®æ—¶ï¼Œè¿™é‡Œä¹Ÿä¼šå‡èµ·æ™¨é›¾ï¼›å¤œæ·±äº†ï¼Œè¿™é‡Œä¹Ÿä¼šç‚¹äº®æ˜Ÿç©ºã€‚å®ƒå°±åƒä½ çš„å½±å­ï¼Œé»˜é»˜é™ªç€ä½ å‘¼å¸ã€‚åˆ«æŠŠå®ƒå½“æˆä»»åŠ¡ï¼Œæƒ³å†™å°±å†™ï¼ŒæŠŠé‚£äº›é—ªé—ªå‘å…‰çš„ç¬é—´ä¸¢è¿›æ²³é‡Œï¼Œå®ƒä»¬ä¸ä¼šä¸¢ï¼Œåªæ˜¯æµå‘äº†æœªæ¥ã€‚
                        </p>
                    </div>

                    <div class="p-4 rounded-2xl bg-[var(--line)]/30 border border-[var(--line)]">
                        <h3 class="flex items-center gap-2 font-bold text-[var(--text)] mb-4 text-xs uppercase tracking-wider opacity-70"><i data-lucide="feather" class="w-3.5 h-3.5"></i> ä¹¦å†™é­”æ³• (Writing Spells)</h3>
                        <div class="space-y-3">
                            <div class="flex gap-3 items-start">
                                <div class="w-6 h-6 rounded-full bg-[var(--primary)]/10 flex items-center justify-center shrink-0 mt-0.5"><span class="text-[10px] font-bold text-[var(--primary)]">1</span></div>
                                <div class="text-xs opacity-80 leading-relaxed">
                                    <strong>æ‰€è§å³æ‰€å¾—ï¼š</strong> åˆ«ç®¡æ’ç‰ˆï¼Œæ‰“å­—å°±å¥½ã€‚æƒ³å¤§å£°è¯´è¯ï¼ŸåŠ ä¸ªäº•å· <code class="bg-black/5 px-1 rounded">#</code>ã€‚æƒ³å¼•ç”¨è°çš„è¯—ï¼ŸåŠ ä¸ªç®­å¤´ <code class="bg-black/5 px-1 rounded">></code>ã€‚å­—ä¼šè‡ªåŠ¨å˜å¥½çœ‹ã€‚
                                </div>
                            </div>
                            <div class="flex gap-3 items-start">
                                <div class="w-6 h-6 rounded-full bg-[var(--primary)]/10 flex items-center justify-center shrink-0 mt-0.5"><span class="text-[10px] font-bold text-[var(--primary)]">2</span></div>
                                <div class="text-xs opacity-80 leading-relaxed">
                                    <strong>å®šæ ¼ç¬é—´ï¼š</strong> ç‚¹é‚£ä¸ª <i data-lucide="image" class="w-3 h-3 inline"></i> å›¾æ ‡ï¼ŒæŠŠç…§ç‰‡è´´è¿›å»ã€‚ç¬¬ä¸€å¼ ç…§ç‰‡ä¼šè‡ªåŠ¨å˜æˆè¿™æ®µè®°å¿†çš„â€œå°é¢â€ï¼Œåœ¨æ—¶é—´è½´ä¸Šé—ªé—ªå‘å…‰ã€‚
                                </div>
                            </div>
                            <div class="flex gap-3 items-start">
                                <div class="w-6 h-6 rounded-full bg-purple-100 flex items-center justify-center shrink-0 mt-0.5"><span class="text-[10px] font-bold text-purple-600">3</span></div>
                                <div class="text-xs opacity-80 leading-relaxed">
                                    <strong>çµæ„Ÿæ¶Œç°ï¼š</strong> æç¬”å¿˜å­—ï¼Ÿç‚¹ä¸€ä¸‹ç´«è‰²çš„ <span class="text-purple-500 font-bold">Inspire AI</span>ã€‚å®ƒä¼šçœ‹çœ‹ç°åœ¨çš„å¤©æ°”ï¼Œæ„Ÿåº”ä½ çš„å¿ƒæƒ…ï¼Œç„¶ååƒä¸ªè€å‹ä¸€æ ·ï¼Œæ›¿ä½ å†™ä¸‹ç¬¬ä¸€å¥æ¸©æš–çš„å¼€åœºç™½ã€‚
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="border border-[var(--line)] rounded-xl overflow-hidden bg-[var(--card-bg)]">
                        <div class="bg-[var(--line)]/30 p-2 text-center text-[10px] font-bold text-[var(--text-sec)] uppercase tracking-widest">å’’è¯­é€ŸæŸ¥è¡¨</div>
                        <div class="grid grid-cols-3 text-xs divide-x divide-[var(--line)] border-t border-[var(--line)]">
                            <div class="p-2 bg-[var(--line)]/10 text-center opacity-50 font-bold">ä½ è¾“å…¥...</div>
                            <div class="p-2 bg-[var(--line)]/10 text-center opacity-50 font-bold">é­”æ³•æ•ˆæœ</div>
                            <div class="p-2 bg-[var(--line)]/10 text-center opacity-50 font-bold">æ ·å­</div>
                            
                            <div class="p-3 text-center font-mono"><span class="text-[var(--primary)]">#</span> æ ‡é¢˜</div>
                            <div class="p-3 text-center opacity-80">å˜æˆå¤§æ ‡é¢˜</div>
                            <div class="p-3 text-center font-bold text-base">æ ‡é¢˜</div>

                            <div class="p-3 text-center font-mono"><span class="text-[var(--primary)]">></span> é‡‘å¥</div>
                            <div class="p-3 text-center opacity-80">å˜æˆå¼•ç”¨</div>
                            <div class="p-3 text-center italic opacity-60 border-l-2 border-gray-400 pl-2">é‡‘å¥</div>

                            <div class="p-3 text-center font-mono"><span class="text-[var(--primary)]">**</span>é‡ç‚¹<span class="text-[var(--primary)]">**</span></div>
                            <div class="p-3 text-center opacity-80">å˜æˆåŠ ç²—</div>
                            <div class="p-3 text-center font-black">é‡ç‚¹</div>
                        </div>
                    </div>

                    <div class="relative group overflow-hidden rounded-2xl shadow-lg cursor-pointer transition-transform hover:scale-[1.01]">
                        <div class="absolute inset-0 bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900 opacity-95 z-0"></div>
                        <div class="absolute -top-10 -right-10 w-40 h-40 bg-purple-500 rounded-full mix-blend-overlay filter blur-[50px] opacity-30 animate-pulse-slow"></div>
                        
                        <div class="relative z-10 p-6 text-white/90">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-2">
                                    <div class="p-1.5 bg-white/10 rounded-lg border border-white/10"><i data-lucide="moon" class="w-4 h-4 text-yellow-200"></i></div>
                                    <h3 class="font-logo font-bold tracking-widest text-white text-sm">THE ORACLE</h3>
                                </div>
                                <span class="text-[10px] bg-white/10 px-2 py-1 rounded-full text-purple-200">æ¯å‘¨æ—¥å¼€å¯</span>
                            </div>
                            
                            <p class="text-xs leading-loose font-serif opacity-80 mb-4">
                                åœ¨æ•°æ®æ·±å¤„ï¼Œä½ç€ä¸€ä½æ— å½¢çš„æ™ºè€…ã€‚å½“ä½ è¿·èŒ«æ—¶ï¼Œç‚¹å‡»å³ä¸‹è§’çš„ <span class="inline-block px-1.5 bg-white/20 rounded text-white font-bold">âœ¨</span> å¬å”¤å®ƒã€‚å®ƒä¼šè¯»å–æ˜Ÿè±¡ä¸ä½ çš„è®°å½•ï¼Œä¸ºä½ æŒ‡å¼•æ–¹å‘ã€‚
                            </p>
                            
                            <div class="grid grid-cols-3 gap-2 text-[10px] opacity-70 text-center">
                                <div class="bg-white/5 p-2 rounded border border-white/5">
                                    <div class="text-lg mb-1">ğŸ”®</div>
                                    <div>å æ˜Ÿå¥³å·«</div>
                                </div>
                                <div class="bg-white/5 p-2 rounded border border-white/5">
                                    <div class="text-lg mb-1">â˜¯ï¸</div>
                                    <div>ä¸œæ–¹éšå£«</div>
                                </div>
                                <div class="bg-white/5 p-2 rounded border border-white/5">
                                    <div class="text-lg mb-1">ğŸ§¬</div>
                                    <div>äººç”Ÿå¯¼å¸ˆ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="guide-en" class="space-y-8 font-sans text-sm leading-relaxed hidden">
                    
                    <div class="p-5 rounded-2xl bg-gradient-to-br from-[var(--card-bg)] to-[var(--line)]/50 border border-[var(--line)] shadow-sm text-center relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1 bg-[var(--primary)] opacity-50"></div>
                        <h3 class="font-logo font-bold text-base text-[var(--primary)] mb-3 tracking-widest">Hello, Traveler</h3>
                        <p class="opacity-80 text-xs leading-loose text-justify px-2">
                            Listen closely. This isn't just a notepad. It's a <strong>River</strong>.<br><br>
                            There are no pages to turn, only time flowing endlessly. Watch the skyâ€”when it's dawn outside, the mist rises here too. When night falls, the stars awake. It breathes with you. Don't treat it like a chore. Just cast your moments into the stream; they aren't lost, they simply flow into your future.
                        </p>
                    </div>

                    <div class="p-4 rounded-2xl bg-[var(--line)]/30 border border-[var(--line)]">
                        <h3 class="flex items-center gap-2 font-bold text-[var(--text)] mb-4 text-xs uppercase tracking-wider opacity-70"><i data-lucide="feather" class="w-3.5 h-3.5"></i> Writing Spells</h3>
                        <div class="space-y-3">
                            <div class="flex gap-3 items-start">
                                <div class="w-6 h-6 rounded-full bg-[var(--primary)]/10 flex items-center justify-center shrink-0 mt-0.5"><span class="text-[10px] font-bold text-[var(--primary)]">1</span></div>
                                <div class="text-xs opacity-80 leading-relaxed">
                                    <strong>Just Write:</strong> Want to shout? Add a hash <code class="bg-black/5 px-1 rounded">#</code>. Want to whisper a quote? Use a beak <code class="bg-black/5 px-1 rounded">></code>. The magic handles the rest.
                                </div>
                            </div>
                            <div class="flex gap-3 items-start">
                                <div class="w-6 h-6 rounded-full bg-[var(--primary)]/10 flex items-center justify-center shrink-0 mt-0.5"><span class="text-[10px] font-bold text-[var(--primary)]">2</span></div>
                                <div class="text-xs opacity-80 leading-relaxed">
                                    <strong>Capture:</strong> Click <i data-lucide="image" class="w-3 h-3 inline"></i> to pin a photo. The first one becomes the cover of this memory.
                                </div>
                            </div>
                            <div class="flex gap-3 items-start">
                                <div class="w-6 h-6 rounded-full bg-purple-100 flex items-center justify-center shrink-0 mt-0.5"><span class="text-[10px] font-bold text-purple-600">3</span></div>
                                <div class="text-xs opacity-80 leading-relaxed">
                                    <strong>Inspiration:</strong> Stuck? Click the purple <span class="text-purple-500 font-bold">Inspire AI</span>. It senses the weather and your mood, then writes a warm opening line for you, like an old friend.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="border border-[var(--line)] rounded-xl overflow-hidden bg-[var(--card-bg)]">
                        <div class="bg-[var(--line)]/30 p-2 text-center text-[10px] font-bold text-[var(--text-sec)] uppercase tracking-widest">Spellbook Cheat Sheet</div>
                        <div class="grid grid-cols-3 text-xs divide-x divide-[var(--line)] border-t border-[var(--line)]">
                            <div class="p-2 bg-[var(--line)]/10 text-center opacity-50 font-bold">You Type</div>
                            <div class="p-2 bg-[var(--line)]/10 text-center opacity-50 font-bold">Effect</div>
                            <div class="p-2 bg-[var(--line)]/10 text-center opacity-50 font-bold">Result</div>
                            
                            <div class="p-3 text-center font-mono"><span class="text-[var(--primary)]">#</span> Text</div>
                            <div class="p-3 text-center opacity-80">Big Title</div>
                            <div class="p-3 text-center font-bold text-base">Title</div>

                            <div class="p-3 text-center font-mono"><span class="text-[var(--primary)]">></span> Text</div>
                            <div class="p-3 text-center opacity-80">Quote Block</div>
                            <div class="p-3 text-center italic opacity-60 border-l-2 border-gray-400 pl-2">Quote</div>

                            <div class="p-3 text-center font-mono"><span class="text-[var(--primary)]">**</span>Text<span class="text-[var(--primary)]">**</span></div>
                            <div class="p-3 text-center opacity-80">Bold</div>
                            <div class="p-3 text-center font-black">Bold</div>
                        </div>
                    </div>

                    <div class="relative group overflow-hidden rounded-2xl shadow-lg cursor-pointer transition-transform hover:scale-[1.01]">
                        <div class="absolute inset-0 bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900 opacity-95 z-0"></div>
                        <div class="absolute -top-10 -right-10 w-40 h-40 bg-purple-500 rounded-full mix-blend-overlay filter blur-[50px] opacity-30 animate-pulse-slow"></div>
                        
                        <div class="relative z-10 p-6 text-white/90">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-2">
                                    <div class="p-1.5 bg-white/10 rounded-lg border border-white/10"><i data-lucide="moon" class="w-4 h-4 text-yellow-200"></i></div>
                                    <h3 class="font-logo font-bold tracking-widest text-white text-sm">THE ORACLE</h3>
                                </div>
                                <span class="text-[10px] bg-white/10 px-2 py-1 rounded-full text-purple-200">Sundays</span>
                            </div>
                            
                            <p class="text-xs leading-loose font-serif opacity-80 mb-4">
                                Deep within the code lives a formless Sage. When lost, click <span class="inline-block px-1.5 bg-white/20 rounded text-white font-bold">âœ¨</span> to summon it. It reads the stars and your words to guide your path.
                            </p>
                            
                            <div class="grid grid-cols-3 gap-2 text-[10px] opacity-70 text-center">
                                <div class="bg-white/5 p-2 rounded border border-white/5"><div class="text-lg mb-1">ğŸ”®</div><div>Witch</div></div>
                                <div class="bg-white/5 p-2 rounded border border-white/5"><div class="text-lg mb-1">â˜¯ï¸</div><div>Hermit</div></div>
                                <div class="bg-white/5 p-2 rounded border border-white/5"><div class="text-lg mb-1">ğŸ§¬</div><div>Mentor</div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pt-8 border-t border-[var(--line)] mt-8">
                    
                    <div class="mb-8">
                        <h3 class="font-bold text-[10px] uppercase tracking-[0.2em] mb-4 opacity-60 text-center" data-i18n="lbl_daily_goals">Energy Anchors (Goals)</h3>
                        <div class="grid grid-cols-3 gap-3">
                            <div class="group"><label class="block text-[9px] font-bold text-[var(--text-sec)] mb-1 text-center">Cals</label><input type="number" id="goal-cals" class="w-full p-2 rounded-xl text-xs text-center font-bold bg-[var(--line)]/30 outline-none focus:bg-[var(--card-bg)] border border-transparent focus:border-[var(--primary)] transition-all" placeholder="2000" onchange="UI.saveGoals()"></div>
                            <div class="group"><label class="block text-[9px] font-bold text-[var(--text-sec)] mb-1 text-center">Sleep (h)</label><input type="number" id="goal-sleep" class="w-full p-2 rounded-xl text-xs text-center font-bold bg-[var(--line)]/30 outline-none focus:bg-[var(--card-bg)] border border-transparent focus:border-[var(--primary)] transition-all" placeholder="8" onchange="UI.saveGoals()"></div>
                            <div class="group"><label class="block text-[9px] font-bold text-[var(--text-sec)] mb-1 text-center">Focus (m)</label><input type="number" id="goal-focus" class="w-full p-2 rounded-xl text-xs text-center font-bold bg-[var(--line)]/30 outline-none focus:bg-[var(--card-bg)] border border-transparent focus:border-[var(--primary)] transition-all" placeholder="60" onchange="UI.saveGoals()"></div>
                            <div class="group"><label class="block text-[9px] font-bold text-[var(--text-sec)] mb-1 text-center">Sport (m)</label><input type="number" id="goal-exercise" class="w-full p-2 rounded-xl text-xs text-center font-bold bg-[var(--line)]/30 outline-none focus:bg-[var(--card-bg)] border border-transparent focus:border-[var(--primary)] transition-all" placeholder="30" onchange="UI.saveGoals()"></div>
                            <div class="group col-span-2"><label class="block text-[9px] font-bold text-[var(--text-sec)] mb-1 text-center">Meditation (m)</label><input type="number" id="goal-meditation" class="w-full p-2 rounded-xl text-xs text-center font-bold bg-[var(--line)]/30 outline-none focus:bg-[var(--card-bg)] border border-transparent focus:border-[var(--primary)] transition-all" placeholder="15" onchange="UI.saveGoals()"></div>
                        </div>
                    </div>

                    <div class="space-y-3">
                        <h3 class="font-bold text-[10px] uppercase tracking-[0.2em] mb-2 opacity-40 text-center">Soul Binding (Settings)</h3>
                        
                        <div class="group p-3 bg-[var(--card-bg)] border border-[var(--line)] rounded-xl hover:border-blue-300 transition-colors shadow-sm">
                            <h4 class="text-[10px] font-bold text-blue-600/80 mb-1 uppercase tracking-wider flex items-center gap-1"><i data-lucide="cpu" class="w-3 h-3"></i> Deepseek API (Brain)</h4>
                            <input type="password" id="user-deepseek-key" class="w-full bg-transparent text-xs font-mono outline-none placeholder:opacity-30" placeholder="sk-..." onchange="localStorage.setItem('deepseek_api_key', this.value)">
                        </div>
                        
                        <div class="group p-3 bg-[var(--card-bg)] border border-[var(--line)] rounded-xl hover:border-purple-300 transition-colors shadow-sm">
                            <h4 class="text-[10px] font-bold text-purple-600/80 mb-1 uppercase tracking-wider flex items-center gap-1"><i data-lucide="scan-eye" class="w-3 h-3"></i> Qwen-VL API (Vision)</h4>
                            <input type="password" id="user-qwen-vl-key" class="w-full bg-transparent text-xs font-mono outline-none placeholder:opacity-30" placeholder="sk-..." onchange="localStorage.setItem('qwen_vl_api_key', this.value)">
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div class="p-2 bg-[var(--line)]/20 rounded-xl">
                                <label class="text-[9px] font-bold text-[var(--text-sec)] block uppercase mb-1 ml-1">Zodiac</label>
                                <input type="text" id="user-zodiac" class="w-full bg-transparent text-xs outline-none font-bold text-[var(--text)] px-1" placeholder="e.g. Scorpio">
                            </div>
                            <div class="p-2 bg-[var(--line)]/20 rounded-xl">
                                <label class="text-[9px] font-bold text-[var(--text-sec)] block uppercase mb-1 ml-1">Birth Date</label>
                                <input type="text" id="user-bazi" class="w-full bg-transparent text-xs outline-none font-bold text-[var(--text)] px-1" placeholder="YYYY-MM-DD">
                            </div>
                        </div>
                    </div>
                    
                    <p class="text-[10px] text-center opacity-30 mt-8 font-serif italic pb-4">Your timeline is bound locally. Only you hold the key.</p>
                </div>
            </div>
        </div>
    </div>
    <div id="summary-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="UI.closeWeeklySummary()"></div>
        
        <div class="oracle-theme-bg w-full max-w-md rounded-3xl relative z-10 flex flex-col max-h-[85vh] overflow-hidden animate-in fade-in zoom-in-95 duration-300">
            
            <div class="absolute top-[-50px] left-[-50px] w-40 h-40 bg-purple-500 rounded-full blur-[60px] opacity-40 pointer-events-none animate-pulse-slow"></div>
            <div class="absolute bottom-[-20px] right-[-20px] w-32 h-32 bg-indigo-500 rounded-full blur-[50px] opacity-30 pointer-events-none"></div>

            <div class="p-5 flex justify-between items-center relative z-20 border-b border-white/10 bg-black/20 backdrop-blur-md">
                <h2 class="text-lg font-bold flex items-center gap-2 font-logo tracking-[0.2em] text-white">
                    <i data-lucide="sparkles" class="w-4 h-4 text-purple-300"></i>
                    <span data-i18n="oracle_title">THE ORACLE</span>
                </h2>
                <button onclick="UI.closeWeeklySummary()" class="p-2 hover:bg-white/10 rounded-full transition-colors text-white/70 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>

            <div class="p-6 overflow-y-auto no-scrollbar relative z-20">
                
                <div id="oracle-input-view" class="space-y-8">
                    
                    <div class="text-center space-y-2 mt-2">
                        <h3 class="font-logo font-bold text-2xl text-transparent bg-clip-text bg-gradient-to-r from-purple-200 to-pink-200" data-i18n="oracle_subtitle">Weekly Guidance</h3>
                        <p class="text-xs text-purple-200/60 leading-relaxed px-4 font-serif" data-i18n="oracle_intro">The AI sage reads your past 7 days to reveal the path ahead.</p>
                    </div>

                    <div class="space-y-3">
                        <div class="text-[10px] font-bold uppercase tracking-widest text-white/40 text-center" data-i18n="lbl_persona">Choose Guide</div>
                        <div class="flex justify-center gap-3">
                            <button onclick="UI.setPersona('western')" id="btn-western" class="oracle-btn active flex-1 py-3 rounded-xl flex flex-col items-center gap-1 group">
                                <span class="text-xl group-hover:scale-110 transition-transform">ğŸ”®</span>
                                <span class="text-[10px] font-bold uppercase tracking-wider" data-i18n="p_western">Western</span>
                            </button>
                            <button onclick="UI.setPersona('eastern')" id="btn-eastern" class="oracle-btn flex-1 py-3 rounded-xl flex flex-col items-center gap-1 group">
                                <span class="text-xl group-hover:scale-110 transition-transform">â˜¯ï¸</span>
                                <span class="text-[10px] font-bold uppercase tracking-wider" data-i18n="p_eastern">Eastern</span>
                            </button>
                            <button onclick="UI.setPersona('coach')" id="btn-coach" class="oracle-btn flex-1 py-3 rounded-xl flex flex-col items-center gap-1 group">
                                <span class="text-xl group-hover:scale-110 transition-transform">ğŸ§¬</span>
                                <span class="text-[10px] font-bold uppercase tracking-wider" data-i18n="p_coach">Coach</span>
                            </button>
                        </div>
                    </div>

                    <div class="space-y-4 bg-black/20 p-5 rounded-2xl border border-white/5">
                        <div class="space-y-1.5">
                            <label class="text-[9px] font-bold text-purple-200/70 uppercase tracking-widest ml-1 flex items-center gap-1"><i data-lucide="star" class="w-3 h-3"></i> <span data-i18n="lbl_zodiac">Zodiac</span></label>
                            <input type="text" id="oracle-zodiac" class="oracle-input w-full rounded-lg px-3 py-2.5 text-xs font-bold outline-none" data-placeholder="ph_zodiac" placeholder="e.g. Scorpio">
                        </div>
                        <div class="space-y-1.5">
                            <label class="text-[9px] font-bold text-purple-200/70 uppercase tracking-widest ml-1 flex items-center gap-1"><i data-lucide="calendar" class="w-3 h-3"></i> <span data-i18n="lbl_bazi">Birth Date</span></label>
                            <input type="text" id="oracle-bazi" class="oracle-input w-full rounded-lg px-3 py-2.5 text-xs font-bold outline-none" data-placeholder="ph_bazi" placeholder="e.g. 1995-05-20">
                        </div>
                    </div>

                    <button onclick="UI.generateReport()" class="w-full py-4 bg-gradient-to-r from-indigo-400 to-purple-500 text-white rounded-xl font-bold shadow-[0_0_20px_rgba(168,85,247,0.4)] hover:shadow-[0_0_30px_rgba(168,85,247,0.6)] hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-2 uppercase tracking-wider text-xs">
                        <i data-lucide="sparkles" class="w-4 h-4"></i> 
                        <span data-i18n="btn_consult">Reveal Prophecy</span>
                    </button>
                </div>

                <div id="oracle-result-view" class="hidden flex flex-col h-full animate-in slide-in-from-right-8 duration-300">
                    
                    <div id="summary-ai-content" class="oracle-result-box prose prose-sm max-w-none p-6 min-h-[300px] text-justify mb-6 shadow-2xl overflow-y-auto">
                        </div>
                    
                    <div class="flex gap-3 mt-auto">
                        <button onclick="UI.resetOracle()" class="px-4 py-3 border border-white/20 text-white/80 rounded-xl font-bold text-xs hover:bg-white/10 transition-colors" data-i18n="btn_ask_again">Ask Again</button>
                        <button onclick="UI.saveOracleResult()" class="flex-1 py-3 bg-white text-purple-900 rounded-xl font-bold text-xs shadow-lg hover:bg-purple-50 transition-all flex items-center justify-center gap-2 uppercase tracking-wide">
                            <i data-lucide="save" class="w-4 h-4"></i> <span data-i18n="btn_save_oracle">Save</span>
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script src="db.js"></script>
    <script src="app.js"></script>
  

    <div id="detail-modal" class="hidden fixed inset-0 z-[70] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="UI.closeDetail()"></div>
        <div class="bg-[var(--card-bg)] w-full max-w-lg rounded-2xl shadow-2xl relative z-10 flex flex-col max-h-[90vh] overflow-hidden border border-[var(--card-border)] animate-in zoom-in-95 duration-200">
            
            <div id="detail-image-container" class="w-full h-48 bg-gray-100 hidden relative">
                <img id="detail-image" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-[var(--card-bg)] to-transparent"></div>
            </div>

            <div class="p-6 overflow-y-auto no-scrollbar">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h2 id="detail-title" class="text-2xl font-bold text-[var(--text)] font-display leading-tight">Title</h2>
                        <div class="flex items-center gap-2 mt-2 text-xs font-bold text-[var(--text-sec)] uppercase tracking-wider">
                            <span id="detail-date">Date</span>
                            <span class="w-1 h-1 rounded-full bg-[var(--text-sec)]"></span>
                            <span id="detail-time">Time</span>
                            <span class="w-1 h-1 rounded-full bg-[var(--text-sec)]"></span>
                            <span id="detail-lunar" class="opacity-70">Lunar</span>
                        </div>
                    </div>
                    <div id="detail-calories" class="bg-orange-100 text-orange-600 px-2 py-1 rounded text-[10px] font-bold hidden"></div>
                </div>

                <div id="detail-content" class="prose prose-sm max-w-none text-[var(--text)] md-render"></div>
            </div>

            <div class="p-4 border-t border-[var(--line)] bg-[var(--card-bg)]/95 backdrop-blur flex justify-between items-center gap-4">
                <button onclick="UI.confirmDeleteEntry()" class="p-2 text-red-400 hover:bg-red-50 rounded-full transition-colors"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                <div class="flex gap-3">
                    <button onclick="UI.editCurrentEntry()" class="px-5 py-2 bg-[var(--line)] text-[var(--text)] rounded-xl font-bold text-xs hover:bg-[var(--primary)] hover:text-white transition-colors">EDIT</button>
                    <button onclick="UI.closeDetail()" class="px-5 py-2 bg-[var(--text)] text-[var(--card-bg)] rounded-xl font-bold text-xs hover:opacity-80 transition-opacity">CLOSE</button>
                </div>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="hidden fixed inset-0 z-[80] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/20" onclick="document.getElementById('confirm-modal').classList.add('hidden')"></div>
        <div class="bg-[var(--card-bg)] p-6 rounded-2xl shadow-xl relative z-10 w-full max-w-xs text-center border border-[var(--line)]">
            <h3 class="font-bold text-lg text-[var(--text)] mb-2" data-i18n="delete_title">Delete Memory?</h3>
            <p class="text-xs text-[var(--text-sec)] mb-6" data-i18n="delete_desc">This action cannot be undone.</p>
            <div class="flex gap-3 justify-center">
                <button onclick="document.getElementById('confirm-modal').classList.add('hidden')" class="px-4 py-2 rounded-lg border border-[var(--line)] text-xs font-bold text-[var(--text-sec)]" data-i18n="btn_cancel">Cancel</button>
                <button onclick="UI.executeDelete()" class="px-4 py-2 rounded-lg bg-red-500 text-white text-xs font-bold" data-i18n="btn_delete">Delete</button>
            </div>
        </div>
    </div>
</body>
</html>